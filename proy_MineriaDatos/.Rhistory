U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
# corrigiendo el problema
S<-diag(r^(-0.5))%*%(P-r%*%t(c))%*% diag(c^(-0.5))
# 2 descomposición SVD
svd(S)
U<-svd(S)$u
V<-svd(S)$v
Da<-diag(svd(S)$d)
#verificando las propiedades
U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
# corrigiendo el problema
S<-diag(r^(-0.5))%*%(P-r%*%t(c))%*% diag(c^(-0.5))
# 2 descomposición SVD
svd(S)
U<-svd(S)$u
V<-svd(S)$v
Da<-diag(svd(S)$d)
#verificando las propiedades
U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
```
Resultados en 2 y 1 dimension
```{r,echo=FALSE}
#incluyendo mas información
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.5+r*2)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.5+c*2)
abline(h=0,v=0,lty=2)
title("Mujeres mayores de 15 años humilladas o menospreciadas por un
hombre conocido o desconocido en un lugar publico a lo largo de su
vida")
#viendo solo una dimensión
plot(rep(0,dim(FF)[1]),FF[,1],type = "n", axes = F)
axis(2)
text(rep(0,dim(FF)[1]),FF[,1],labels = lrow,col="red",cex=0.5+r*2)
text(rep(0,dim(G)[1]),G[,1],labels = lcol,col="blue",cex=0.5+c*2)
abline(h=0,v=0,lty=2)
title("Mujeres mayores de 15 años humilladas o menospreciadas por un
hombre conocido o desconocido en un lugar publico a lo largo de su
vida")
```
utilizando la libreria FactoMineR Y explor
```{r, echo=FALSE}
library(FactoMineR)
library(explor)
mca<-MCA(sol[,c(4,7)])
explor(mca)
str(bd_sol$area)
str(bd_sol$S1_01_1)
library(dplyr)
library(ca)
table(bd_sol$S1_01_1)
sol<-bd_sol %>% rename(Mujeres_humilladas_en_publico_por_un_hombre=S1_01_1)
t1<-bd_sol %>% select(depto,S1_01_1) %>% table()
attr(t1,"names")
chisq.test(t1)
str(t1)
res1<-ca(t1)
res1
plot(res1)
```
analisis de correspondencia
programando
```{r, echo=FALSE}
#programando el ca
lcol<-colnames(t1)
lrow<-rownames(t1)
P<-prop.table(t1)
r<-margin.table(P,1)
c<-margin.table(P,2)
Dr<-diag(r)
Dc<-diag(c)
##Paso 1
P-r%*%t(c)
# corrigiendo el problema
S<-diag(r^(-0.5))%*%(P-r%*%t(c))%*% diag(c^(-0.5))
# 2 descomposición SVD
svd(S)
U<-svd(S)$u
V<-svd(S)$v
Da<-diag(svd(S)$d)
#verificando las propiedades
U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
# corrigiendo el problema
S<-diag(r^(-0.5))%*%(P-r%*%t(c))%*% diag(c^(-0.5))
# 2 descomposición SVD
svd(S)
U<-svd(S)$u
V<-svd(S)$v
Da<-diag(svd(S)$d)
#verificando las propiedades
U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
# corrigiendo el problema
S<-diag(r^(-0.5))%*%(P-r%*%t(c))%*% diag(c^(-0.5))
# 2 descomposición SVD
svd(S)
U<-svd(S)$u
V<-svd(S)$v
Da<-diag(svd(S)$d)
#verificando las propiedades
U %*% t(U)
t(V) %*% V
U %*% Da %*% t(V)
S
# 3 Coordenadas principales filas
FF<- diag(r^(-0.5)) %*% U %*% Da
# 4 Coordenadas principales columnas
G<- diag(c^(-0.5)) %*% V %*% Da
# 5 Coordenadas estandar filas
X<- diag(r^(-0.5)) %*% U
# 6 Coordenadas estandar columnas
Y<- diag(c^(-0.5)) %*% V
# 7 inercia
sum(((P-r%*%t(c))**2)/(r%*%t(c)))
#graficando
xmin<-min(c(FF[,1],G[,1]))
xmax<-max(c(FF[,1],G[,1]))
ymin<-min(c(FF[,2],G[,2]))
ymax<-max(c(FF[,2],G[,2]))
plot(FF[,1],FF[,2],col="red",xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1)
points(G[,1],G[,2],col="blue")
abline(h=0,v=0,lty=2)
#incluyendo el texto
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.7)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.7)
abline(h=0,v=0,lty=2)
```
Resultados en 2 y 1 dimension
```{r,echo=FALSE}
#incluyendo mas información
plot(FF[,1],FF[,2],xlim=c(xmin,xmax)*1.5,ylim=c(ymin,ymax)*1.1,type = "n")
text(FF[,1],FF[,2],labels = lrow,col="red",cex=0.5+r*2)
text(G[,1],G[,2],labels = lcol,col="blue",cex=0.5+c*2)
abline(h=0,v=0,lty=2)
title("Mujeres mayores de 15 años humilladas o menospreciadas por un
hombre conocido o desconocido en un lugar publico a lo largo de su
vida")
#viendo solo una dimensión
plot(rep(0,dim(FF)[1]),FF[,1],type = "n", axes = F)
axis(2)
text(rep(0,dim(FF)[1]),FF[,1],labels = lrow,col="red",cex=0.5+r*2)
text(rep(0,dim(G)[1]),G[,1],labels = lcol,col="blue",cex=0.5+c*2)
abline(h=0,v=0,lty=2)
title("Mujeres mayores de 15 años humilladas o menospreciadas por un
hombre conocido o desconocido en un lugar publico a lo largo de su
vida")
```
utilizando la libreria FactoMineR Y explor
```{r, echo=FALSE}
library(FactoMineR)
library(explor)
mca<-MCA(sol[,c(4,7)])
explor(mca)
res <- explor::prepare_results(mca)
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = FALSE, var_sup_choice = ,
var_lab_min_contrib = 0, col_var = "Variable", symbol_var = NULL, size_var = NULL,
size_range = c(10, 300), labels_size = 10, point_size = 56, transitions = TRUE,
labels_positions = "auto", labels_prepend_var = FALSE, xlim = c(-2.74, 2.66),
ylim = c(-2.4, 3))
library(dplyr)
aux<-seq(284,347,3)
bd_lp<-bd_cas %>% dplyr::select(aux)
str(bd_lp)
levels(bd_lp$S3_10_13)
table(is.na(bd_lp))
aux2<-c("1. Muchas veces","2. Pocas veces","3. Una vez")
bd_lp<-bd_lp %>% mutate(indicio_feminicidio=S3_10_13==aux2|S3_10_13==aux2|S3_10_15==aux2|S3_10_16==aux2|S3_10_18==aux2|S3_10_19==aux2)
table(bd_lp$indicio_feminicidio)
var_elim<-c("S3_10_13","S3_10_14","S3_10_15","S3_10_16","S3_10_18","S3_10_19")
bd_lp2<-bd_lp %>% dplyr::select(-var_elim)
Hmisc::describe(bd_lp2)
bd_lp2<-bd_lp2 %>% mutate(pal_gros=S3_10_01==aux2,humillacion=S3_10_02==aux2,prohib_sal=S3_10_03==aux2,amenaza_last=S3_10_04==aux2,amenaza_matar=S3_10_05==aux2,quitar_hijos=S3_10_06==aux2,no_gast_casa=S3_10_07==aux2,prohib_propi=S3_10_08==aux2,destruido_cosas=S3_10_09==aux2,quit_dinero=S3_10_10==aux2,quit_bien=S3_10_11==aux2,empujado=S3_10_12==aux2,amenaza_armas=S3_10_17==aux2,oblig_rela=S3_10_20==aux2,exige_rela=S3_10_21==aux2,oblig_no_gusta=S3_10_22==aux2)
set.seed(123)
index = sample(1:2, nrow(bd_lp2), replace = TRUE, prob=c(0.7, 0.3))
prop.table(table(index))
trainbd<-bd_lp2[index==1,]
testbd<-bd_lp2[index==2,]
m1<-glm(indicio_feminicidio~.-oblig_rela,data=trainbd,family = binomial(link="logit"))
m1<-glm(indicio_feminicidio~.-oblig_rela,data=trainbd,family = binomial(link="logit"))
summary(m1)
m2<-step(m1)
summary(m2)
clase<-predict(m2,testbd,type="response")>0.5
table(clase)
table(testbd$indicio_feminicidio,clase)
library(caret)
confusionMatrix(table(testbd$indicio_feminicidio,clase))
library(mfx)
info<-logitmfx(formula(m2),data=testbd)
barplot(info$mfxest[,1],horiz = T,las=1,cex.names = 0.5,xlim=c(-0.1,0.70),pos=-0.02)
title("Principales Indicios de Feminicidio
Modelo Logit(Efectos Marginales)")
load("C:\\Users\\Dell\\Documents\\GitHub\\mi_proyecto1_EST_384\\proy_MineriaDatos\\bd_proy\\bd_cas.RData")
library(dplyr)
aux<-seq(284,347,3)
bd_lp<-bd_cas %>% dplyr::select(aux)
str(bd_lp)
levels(bd_lp$S3_10_13)
table(is.na(bd_lp))
aux2<-c("1. Muchas veces","2. Pocas veces","3. Una vez")
bd_lp<-bd_lp %>% mutate(indicio_feminicidio=S3_10_13==aux2|S3_10_13==aux2|S3_10_15==aux2|S3_10_16==aux2|S3_10_18==aux2|S3_10_19==aux2)
table(bd_lp$indicio_feminicidio)
var_elim<-c("S3_10_13","S3_10_14","S3_10_15","S3_10_16","S3_10_18","S3_10_19")
bd_lp2<-bd_lp %>% dplyr::select(-var_elim)
Hmisc::describe(bd_lp2)
bd_lp2<-bd_lp2 %>% mutate(pal_gros=S3_10_01==aux2,humillacion=S3_10_02==aux2,prohib_sal=S3_10_03==aux2,amenaza_last=S3_10_04==aux2,amenaza_matar=S3_10_05==aux2,quitar_hijos=S3_10_06==aux2,no_gast_casa=S3_10_07==aux2,prohib_propi=S3_10_08==aux2,destruido_cosas=S3_10_09==aux2,quit_dinero=S3_10_10==aux2,quit_bien=S3_10_11==aux2,empujado=S3_10_12==aux2,amenaza_armas=S3_10_17==aux2,oblig_rela=S3_10_20==aux2,exige_rela=S3_10_21==aux2,oblig_no_gusta=S3_10_22==aux2)
bd_lp2<-bd_lp2 %>% dplyr::select(-c(1:16))
```
bd de entrenamiento y testeo
```{r}
set.seed(123)
index = sample(1:2, nrow(bd_lp2), replace = TRUE, prob=c(0.7, 0.3))
prop.table(table(index))
trainbd<-bd_lp2[index==1,]
testbd<-bd_lp2[index==2,]
```
modelos logit
```{r}
m1<-glm(indicio_feminicidio~.-oblig_rela,data=trainbd,family = binomial(link="logit"))
```
idientificadno las variables significativas
```{r}
summary(m1)
m2<-step(m1)
summary(m2)
```
Predecir la clase de pertenencia en la base de test ($prob>0.5$)
```{r}
clase<-predict(m2,testbd,type="response")>0.5
table(clase)
clase<-predict(m2,testbd,type="response")>0.5
table(clase)
```{r}
clase<-predict(m2,testbd,type="response")>0.5
table(clase)
```
comparando lo observado y lo predicho
```{r}
table(testbd$indicio_feminicidio,clase)
```
Generar la matriz de confusión (librería caret)
```{r}
library(caret)
confusionMatrix(table(testbd$indicio_feminicidio,clase))
library(caret)
confusionMatrix(table(testbd$indicio_feminicidio,clase))
```{r}
library(caret)
confusionMatrix(table(testbd$indicio_feminicidio,clase))
```
Efectos marginales
```{r}
library(mfx)
info<-logitmfx(formula(m2),data=testbd)
barplot(info$mfxest[,1],horiz = T,las=1,cex.names = 0.5,xlim=c(-0.1,0.70),pos=-0.02)
title("Principales Indicios de Feminicidio
Modelo Logit(Efectos Marginales)")
load("C:\\Users\\Dell\\Documents\\GitHub\\mi_proyecto1_EST_384\\proy_MineriaDatos\\bd_proy\\bd_sep.RData")
levels(bd_sep$S3_13_1)
levels(bd_sep$S3_12_1)
levels(bd_sep$S3_13_1)
levels(bd_sep$S3_12_1)
```{r}
levels(bd_sep$S3_13_1)
levels(bd_sep$S3_12_1)
```
variables de interes:
* area	Area geografíca
* S2_5_1	¿Durante su niñez, las personas con las que vivía, alguna vez a usted la insultaban o humillaban?
* S2_5_2	¿Durante su niñez, las personas con las que vivía, alguna vez a usted la amenazaban con pegarla o echarla de la casa?
library(dplyr)
aux3<-c(5,69,133,204,205,seq(206,218,2),seq(279,342,3))
bd_cart<-bd_sep %>% dplyr::select(aux3)
attributes(bd_cart)
bd_cart<-bd_sep %>% dplyr::select(aux3)
attributes(bd_cart)
bd_cart<-bd_sep %>% dplyr::select(aux3)
attributes(bd_cart)
```
sea la variable
denunciar: por lo menos pidio ayuda a alguna institucion, en alguna ocasion
```{r}
#levels(bd_cart$S3_13_4)
levels(bd_cart$S2_5_1)
aux4<-c("1. Muchas veces","2. Pocas veces","3. Una vez")
bd_cart<-bd_cart %>% mutate(violencia_infancia=S2_5_1
==aux4|S2_5_2==aux4|S2_5_3==aux4|S2_5_4==aux4|S2_5_5==aux4|S2_5_6==aux4|S2_5_1==aux4)
levels(bd_cart$S3_10_01)
bd_cart<-bd_cart %>% mutate(pareja_violenta=S3_10_01==aux4|S3_10_02==aux4|S3_10_03==aux4|S3_10_04==aux4|S3_10_05==aux4|S3_10_06==aux4|S3_10_07==aux4|S3_10_08==aux4|S3_10_09==aux4|S3_10_10==aux4|S3_10_11==aux4|S3_10_12==aux4|S3_10_13==aux4|S3_10_14==aux4|S3_10_15==aux4|S3_10_16==aux4|S3_10_17==aux4|S3_10_18==aux4|S3_10_19==aux4|S3_10_20==aux4|S3_10_21==aux4|S3_10_22==aux4)
bd_cart<-bd_cart %>% dplyr::select(-c(6:34))
bd_cart<-bd_cart %>% rename(tutores_se_insultaban=S2_3)
#bd_cart<-bd_cart %>% dplyr::select(-S3_11)
#bd_cart<-bd_cart %>% dplyr::select(-c(S2_7,S2_8))
bd_cart<-na.omit(bd_cart)
#bd_cart<-bd_cart %>% dplyr::select(-S3_11)
#bd_cart<-bd_cart %>% dplyr::select(-c(S2_7,S2_8))
bd_cart<-na.omit(bd_cart)
#bd_cart<-bd_cart %>% dplyr::select(-S3_11)
#bd_cart<-bd_cart %>% dplyr::select(-c(S2_7,S2_8))
bd_cart<-na.omit(bd_cart)
```
haciendo los pasos
```{r}
library(rpart)
str(bd_cart)
bd_cart$violencia_infancia<-factor(bd_cart$violencia_infancia,c(T,F),labels = c("violencia_infancia","no_violencia_infancia"))
bd_cart$pareja_violenta<-factor(bd_cart$pareja_violenta,c(T,F),labels = c("pareja_violenta","no_pareja_violenta"))
bd_cart$pareja_violenta<-factor(bd_cart$pareja_violenta,c(T,F),labels = c("pareja_violenta","no_pareja_violenta"))
bd_cart$pareja_violenta<-factor(bd_cart$pareja_violenta,c(T,F),labels = c("pareja_violenta","no_pareja_violenta"))
```
bases de entrenamiento y test
```{r}
## Bases: trainbd, testbd
set.seed(123)
index = sample(1:2, nrow(bd_cart), replace = TRUE, prob=c(0.7, 0.3))
prop.table(table(index))
trainbd<-bd_cart[index==1,]
testbd<-bd_cart[index==2,]
mod1<-rpart(pareja_violenta~.,data=trainbd)
mod1
mod1
mod1
```
Examinando los parámetros del árbol con printcp
```{r}
printcp(mod1)
plotcp(mod1)
summary(mod1)
summary(mod1)
summary(mod1)
```
visualizar el arbol
```{r}
plot(mod1)
text(mod1,all=T,use.n=T)
#install.packages("rpart.plot")
library(rpart.plot)
rpart.plot(mod1)
load("C:\\Users\\Dell\\Documents\\GitHub\\mi_proyecto1_EST_384\\proy_MineriaDatos\\bd_proy\\bd_sep.RData")
levels(bd_sep$S3_13_1)
levels(bd_sep$S3_12_1)
library(dplyr)
aux3<-c(5,69,133,204,205,seq(206,218,2),seq(279,342,3))
bd_cart<-bd_sep %>% dplyr::select(aux3)
attributes(bd_cart)
#levels(bd_cart$S3_13_4)
levels(bd_cart$S2_5_1)
aux4<-c("1. Muchas veces","2. Pocas veces","3. Una vez")
bd_cart<-bd_cart %>% mutate(violencia_infancia=S2_5_1
==aux4|S2_5_2==aux4|S2_5_3==aux4|S2_5_4==aux4|S2_5_5==aux4|S2_5_6==aux4|S2_5_1==aux4)
levels(bd_cart$S3_10_01)
bd_cart<-bd_cart %>% mutate(pareja_violenta=S3_10_01==aux4|S3_10_02==aux4|S3_10_03==aux4|S3_10_04==aux4|S3_10_05==aux4|S3_10_06==aux4|S3_10_07==aux4|S3_10_08==aux4|S3_10_09==aux4|S3_10_10==aux4|S3_10_11==aux4|S3_10_12==aux4|S3_10_13==aux4|S3_10_14==aux4|S3_10_15==aux4|S3_10_16==aux4|S3_10_17==aux4|S3_10_18==aux4|S3_10_19==aux4|S3_10_20==aux4|S3_10_21==aux4|S3_10_22==aux4)
bd_cart<-bd_cart %>% dplyr::select(-c(6:34))
bd_cart<-bd_cart %>% rename(tutores_se_insultaban=S2_3)
#bd_cart<-bd_cart %>% dplyr::select(-S3_11)
#bd_cart<-bd_cart %>% dplyr::select(-c(S2_7,S2_8))
bd_cart<-na.omit(bd_cart)
library(rpart)
str(bd_cart)
bd_cart$violencia_infancia<-factor(bd_cart$violencia_infancia,c(T,F),labels = c("violencia_infancia","no_violencia_infancia"))
bd_cart$pareja_violenta<-factor(bd_cart$pareja_violenta,c(T,F),labels = c("pareja_violenta","no_pareja_violenta"))
## Bases: trainbd, testbd
set.seed(123)
index = sample(1:2, nrow(bd_cart), replace = TRUE, prob=c(0.7, 0.3))
prop.table(table(index))
trainbd<-bd_cart[index==1,]
testbd<-bd_cart[index==2,]
mod1<-rpart(pareja_violenta~.,data=trainbd)
mod1
printcp(mod1)
plotcp(mod1)
summary(mod1)
plot(mod1)
text(mod1,all=T,use.n=T)
#install.packages("rpart.plot")
library(rpart.plot)
rpart.plot(mod1)
clase<-predict(mod1,testbd,type = "class")
clase<-predict(mod1,testbd,type = "class")
table(clase,testbd$pareja_violenta)
library(caret)
confusionMatrix(table(clase,testbd$pareja_violenta))
